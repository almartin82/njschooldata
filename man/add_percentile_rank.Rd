% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/percentile_rank.R
\name{add_percentile_rank}
\alias{add_percentile_rank}
\title{Add percentile rank columns for any metric}
\usage{
add_percentile_rank(df, metric_col, prefix = NULL)
}
\arguments{
\item{df}{A dataframe, optionally grouped. Grouping defines the comparison set.}

\item{metric_col}{Character. The column name to rank on.}

\item{prefix}{Character. Optional prefix for output column names. If NULL,
uses metric_col as prefix. Default NULL.}
}
\value{
df with added columns:
  \itemize{
    \item \code{{prefix}_rank}: The rank within the group (1 = lowest)
    \item \code{{prefix}_n}: Number of valid observations in the group
    \item \code{{prefix}_percentile}: Percentile rank (0-100)
  }
}
\description{
The fundamental building block for percentile rank calculations.
Given a grouped dataframe and a metric column, calculates the percentile rank
within each group. Percentile rank is defined as the percent of comparison
entities with lesser or equal performance.

This function respects existing grouping on the dataframe. If you want to
calculate percentile rank within specific peer groups (e.g., DFG, county),
group your data appropriately before calling this function, or use
\code{define_peer_group()} to set up the grouping.

Note: This differs from the simpler \code{percentile_rank(x, xo)} in util.R
which calculates percentile rank of a single value within a vector. This
function operates on dataframe columns and adds rank/percentile columns.
}
\examples{
\dontrun{
# Simple statewide percentile
grate \%>\%
  group_by(end_year, subgroup) \%>\%
  add_percentile_rank("grad_rate")

# DFG peer percentile
grate \%>\%
  group_by(end_year, dfg, subgroup) \%>\%
  add_percentile_rank("grad_rate", prefix = "dfg")
}

}

# Task 01: Fix Test Failures (ERROR - Critical)

## Problem Summary

Tests are failing during R CMD check because tidyverse functions (`%>%`, `select`, `filter`, `map_df`, etc.) are not being found at runtime. This is causing the package to fail its test suite entirely.

## Root Cause

The `NAMESPACE` file only contains `export()` directives but **no `import()` or `importFrom()` directives**. This means the package exports functions but doesn't make the tidyverse functions available at runtime.

When the package is loaded, functions like `%>%` from magrittr, `select`/`filter`/`mutate` from dplyr, and `map_df` from purrr are not accessible.

## Current State

### NAMESPACE (problematic)
```
# Generated by roxygen2: do not edit by hand

export(agg_enr_column_order)
export(fetch_enr)
... (only exports, no imports)
```

### DESCRIPTION Imports
```
Imports:
    digest,
    dplyr (>= 1.0.0),
    downloader,
    httr,
    janitor,
    magrittr,
    purrr,
    readr,
    readxl,
    rlang (>= 0.4.0),
    snakecase,
    stringr,
    tidyr (>= 1.0.0)
```

## Solution

Add roxygen2 `@importFrom` or `@import` directives to the package. The standard approach for tidyverse-heavy packages is to create a dedicated file (e.g., `R/njschooldata-package.R`) with import directives.

### Required Imports

1. **magrittr**: `%>%` pipe operator (used everywhere)
2. **dplyr**: `select`, `filter`, `mutate`, `group_by`, `summarise`, `arrange`, `left_join`, `bind_rows`, `rename`, `across`, `everything`, `ungroup`, `distinct`, `slice`, `pull`, `case_when`, `if_else`, `n`
3. **purrr**: `map`, `map_df`, `map_chr`, `map_dbl`, `map_int`, `walk`, `possibly`, `safely`
4. **tidyr**: `pivot_longer`, `pivot_wider`, `separate`, `unite`, `nest`, `unnest`, `drop_na`, `replace_na`
5. **stringr**: `str_sub`, `str_detect`, `str_replace`, `str_extract`, `str_c`, `str_trim`, `str_to_lower`, `str_to_upper`
6. **readr**: `read_csv`, `read_fwf`, `fwf_widths`, `fwf_cols`, `cols`, `col_character`, `col_double`, `col_integer`
7. **rlang**: `.data`, `:=`, `sym`, `enquo`, `!!`

### Implementation

Create `R/njschooldata-package.R`:

```r
#' @keywords internal
"_PACKAGE"

#' @import dplyr
#' @import tidyr
#' @import purrr
#' @importFrom magrittr %>%
#' @importFrom stringr str_sub str_detect str_replace str_extract str_c str_trim
#' @importFrom readr read_csv read_fwf fwf_widths fwf_cols cols col_character col_double col_integer
#' @importFrom rlang .data := sym enquo !!
#' @importFrom stats na.omit setNames
#' @importFrom utils head tail
NULL
```

Then run `devtools::document()` to regenerate NAMESPACE.

## Files to Modify

1. **Create** `R/njschooldata-package.R` - Package-level documentation with imports
2. **Regenerate** `NAMESPACE` via `devtools::document()`

## Verification

After fixing:
```r
devtools::document()
devtools::test()
# Tests should pass
```

## Priority

**CRITICAL** - This is a blocking error. The package cannot be installed or used until this is fixed.

## Related Issues

- Task 02 (Undeclared Imports) may reveal additional packages that need importing
- Task 06 (Global Variables) relates to NSE patterns used with these functions
